

# ğŸ”„ main åˆ†æ”¯ä¸Šçº¿æµç¨‹

### è§¦å‘äº‹ä»¶ï¼šåœ¨ `dev` åˆ†æ”¯åˆ›å»ºæ ‡ç­¾ `v1.0.0`

```bash
git checkout dev
git tag v1.0.0
git push origin v1.0.0
```

æˆ–è€…ä½¿ç”¨ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
./launch/tag.sh
```

### è¯¦ç»†æ‰§è¡Œæµç¨‹ï¼š

```mermaid
graph TD
    A[ğŸ·ï¸ åœ¨ dev åˆ†æ”¯åˆ›å»ºæ ‡ç­¾ v1.0.0] --> B[æ¨é€æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“]
    
    B --> C[ğŸš€ è§¦å‘ buildx-latest-on-tag.yaml]
    B --> D[ğŸ”„ è§¦å‘ merge-tag-to-main.yaml]
    
    C --> C1[éªŒè¯æ ‡ç­¾æ¥è‡ª dev åˆ†æ”¯]
    C1 --> C2[æ„å»º latest é•œåƒ]
    C2 --> C3[æ¨é€åˆ°é˜¿é‡Œäº‘é•œåƒä»“åº“]
    C3 --> C4[åˆ›å»º GitHub Release]
    C4 --> C5[å‘é€æ„å»ºé€šçŸ¥é‚®ä»¶]
    
    D --> D1[éªŒè¯æ ‡ç­¾æ ¼å¼ SemVer]
    D1 --> D2[è·å–æ ‡ç­¾æŒ‡å‘çš„æäº¤]
    D2 --> D3[åˆå¹¶æ ‡ç­¾åˆ° main åˆ†æ”¯]
    D3 --> D4[æ¨é€ main åˆ†æ”¯]
    D4 --> D5[å‘é€åˆå¹¶é€šçŸ¥é‚®ä»¶]
    
    D4 --> E[ğŸ”„ è§¦å‘ sync-main-to-dev.yaml]
    
    E --> E1[æ£€å‡º dev åˆ†æ”¯]
    E1 --> E2[è·å–æœ€æ–° main åˆ†æ”¯]
    E2 --> E3[å°† dev åŸºäº main è¿›è¡Œ rebase]
    E3 --> E4[æ·»åŠ  [skip ci] æ ‡è®°]
    E4 --> E5[å¼ºåˆ¶æ¨é€ dev åˆ†æ”¯]
    
    E5 --> F[âŒ buildx-when-push-dev.yaml è¢«è·³è¿‡]
    F --> G[âœ… æµç¨‹å®Œæˆï¼Œé¿å…å¾ªç¯è§¦å‘]
    
    style A fill:#e1f5fe
    style C fill:#fff3e0
    style D fill:#f3e5f5
    style E fill:#e8f5e8
    style F fill:#ffebee
    style G fill:#e8f5e8
```

## ğŸ“‹ è¯¦ç»†æ­¥éª¤è¯´æ˜

### é˜¶æ®µ 1ï¼šæ ‡ç­¾å‘å¸ƒï¼ˆå¹¶è¡Œæ‰§è¡Œï¼‰

**ğŸš€ buildx-latest-on-tag.yaml** - æ„å»ºç”Ÿäº§é•œåƒ
- âœ… éªŒè¯æ ‡ç­¾æ¥è‡ª `dev` åˆ†æ”¯
- ğŸ³ æ„å»ºå¤šæ¶æ„ Docker é•œåƒï¼ˆamd64ï¼‰
- ğŸ“¤ æ¨é€åˆ°é˜¿é‡Œäº‘é•œåƒä»“åº“ï¼š`latest` æ ‡ç­¾
- ğŸ“ ä½¿ç”¨ AI ç”Ÿæˆ Release Notes
- ğŸ‰ åˆ›å»º GitHub Release
- ğŸ“§ å‘é€æ„å»ºæˆåŠŸé€šçŸ¥

**ğŸ”„ merge-tag-to-main.yaml** - åˆå¹¶åˆ°ä¸»åˆ†æ”¯
- âœ… éªŒè¯æ ‡ç­¾ç¬¦åˆ SemVer æ ¼å¼ï¼ˆå¦‚ `v1.0.0`ï¼‰
- ğŸ“ è·å–æ ‡ç­¾æŒ‡å‘çš„å…·ä½“æäº¤ SHA
- ğŸ”€ å°†è¯¥æäº¤åˆå¹¶åˆ° `main` åˆ†æ”¯ï¼ˆä½¿ç”¨ `--no-ff`ï¼‰
- ğŸ“¤ æ¨é€æ›´æ–°åçš„ `main` åˆ†æ”¯
- ğŸ“§ å‘é€åˆå¹¶é€šçŸ¥é‚®ä»¶

### é˜¶æ®µ 2ï¼šåŒæ­¥å›å¼€å‘åˆ†æ”¯

**ğŸ”„ sync-main-to-dev.yaml** - åŒæ­¥ä¸»åˆ†æ”¯åˆ°å¼€å‘åˆ†æ”¯
- ğŸ¯ è§¦å‘æ¡ä»¶ï¼š`main` åˆ†æ”¯æœ‰æ–°æ¨é€ OR "Merge Tag to Main" å·¥ä½œæµå®Œæˆ
- ğŸ“¥ æ£€å‡º `dev` åˆ†æ”¯
- ğŸ“¤ è·å–æœ€æ–°çš„ `main` åˆ†æ”¯
- ğŸ”„ å°† `dev` åˆ†æ”¯åŸºäº `main` è¿›è¡Œ rebase
- âš ï¸ å†²çªæ—¶è‡ªåŠ¨é€‰æ‹© `dev` çš„ä»£ç 
- ğŸ·ï¸ **å…³é”®**ï¼šåœ¨æäº¤æ¶ˆæ¯ä¸­æ·»åŠ  `[skip ci]` æ ‡è®°
- ğŸš« å¼ºåˆ¶æ¨é€ `dev` åˆ†æ”¯

### é˜¶æ®µ 3ï¼šé¿å…å¾ªç¯è§¦å‘

**âŒ buildx-when-push-dev.yaml** - å¼€å‘ç¯å¢ƒæ„å»ºï¼ˆè¢«è·³è¿‡ï¼‰
- ğŸš« ç”±äºæäº¤æ¶ˆæ¯åŒ…å« `[skip ci]`ï¼ŒGitHub Actions è‡ªåŠ¨è·³è¿‡æ­¤å·¥ä½œæµ
- âœ… æˆåŠŸé¿å…å¾ªç¯è§¦å‘å’Œä¸å¿…è¦çš„æ„å»º

## ğŸ¯ å…³é”®æ”¹è¿›ç‚¹

### 1. **é¿å…å¾ªç¯è§¦å‘** âœ…
- ä½¿ç”¨ `[skip ci]` æ ‡è®°é˜²æ­¢ rebase æ“ä½œè§¦å‘å¼€å‘ç¯å¢ƒæ„å»º
- èŠ‚çœ CI èµ„æºï¼Œé¿å…æ— æ„ä¹‰çš„æ„å»º

### 2. **åŒé‡è§¦å‘å™¨** âœ…
```yaml
on:
  push:
    branches:
      - main
  workflow_run:
    workflows: ['Merge Tag to Main']
    types:
      - completed
```

### 3. **æ™ºèƒ½å†²çªå¤„ç†** âœ…
```bash
git rebase main || {
  git diff --name-only --diff-filter=U | xargs -I {} git checkout --ours {}
  git add -A
  git rebase --continue
}
```

## ğŸ“Š é¢„æœŸç»“æœ

æ‰§è¡Œå®Œæ•´ä¸ªæµç¨‹åï¼Œæ‚¨ä¼šå¾—åˆ°ï¼š

1. **ğŸ‰ GitHub Release**ï¼šåŒ…å« AI ç”Ÿæˆçš„å‘å¸ƒè¯´æ˜
2. **ğŸ³ ç”Ÿäº§é•œåƒ**ï¼š`registry.cn-shanghai.aliyuncs.com/scienceol/service:latest`
3. **ğŸ“§ é‚®ä»¶é€šçŸ¥**ï¼šæ„å»ºå’Œåˆå¹¶çŠ¶æ€é€šçŸ¥
4. **ğŸ”„ åŒæ­¥åˆ†æ”¯**ï¼š`main` å’Œ `dev` ä¿æŒåŒæ­¥
5. **âš¡ é«˜æ•ˆæ‰§è¡Œ**ï¼šé¿å…ä¸å¿…è¦çš„ CI æ„å»º

è¿™ä¸ªè®¾è®¡æ—¢ä¿è¯äº†ç‰ˆæœ¬å‘å¸ƒçš„å®Œæ•´æ€§ï¼Œåˆç»´æŠ¤äº†åˆ†æ”¯é—´çš„åŒæ­¥ï¼ŒåŒæ—¶é¿å…äº†èµ„æºæµªè´¹ï¼